/*! circlepacker v1.1.7 | MIT (c) 2023 Georg Fischer <hi@snorpey.com> | https://github.com/snorpey/circlepacker#readme */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).CirclePacker=e()}(this,(function(){"use strict";var t=function(t,e){"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)};t.prototype.cp=function(){return new t(this.x,this.y)},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this},t.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,this},t.prototype.length=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return t<.005&&t>-.005?1e-6:t},t.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},t.prototype.distanceSquared=function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i};var e=function(e){var i=e.id,o=e.radius,r=e.x,s=e.y,n=e.isPulledToCenter,a=e.isPinned;r=r||0,s=s||0,this.id=i,this.targetPosition=new t(0,0),this.position=new t(r,s),this.previousPosition=new t(r,s),this.isPulledToCenter=n,this.isPinned=a,this.setRadius(o)},i={delta:{configurable:!0}};function o(t,e,i){"number"!=typeof t&&"number"!=typeof e&&(t=0,e=1),"number"!=typeof e&&(e=t,t=0);var o=t+Math.random()*(e-t);return i&&(o=parseInt(o,10)),o}function r(t){return t&&s(t.id)&&t.radius&&t.position&&"number"==typeof t.position.x&&"number"==typeof t.position.y}function s(t){return"number"==typeof t&&!isNaN(t)||"string"==typeof t&&t.length>0}function n(t,e){return"number"==typeof t&&t>=e}function a(t){return"object"==typeof t&&"number"==typeof t.x&&"number"==typeof t.y}e.prototype.setPosition=function(t){this.previousPosition=this.position,this.position=t.cp()},e.prototype.setRadius=function(t){this.radius=t,this.radiusSquared=t*t},i.delta.get=function(){return new t(this.position.x-this.previousPosition.x,this.position.y-this.previousPosition.y)},Object.defineProperties(e.prototype,i);var p=function(t){this.worker=new Worker(URL.createObjectURL(new Blob(["!function(i){\"function\"==typeof define&&define.amd?define(i):i()}((function(){\"use strict\";var i=function(i,t){\"object\"==typeof i?(this.x=i.x,this.y=i.y):(this.x=i,this.y=t)};i.prototype.cp=function(){return new i(this.x,this.y)},i.prototype.mul=function(i){return this.x*=i,this.y*=i,this},i.prototype.normalize=function(){var i=this.length();return this.x/=i,this.y/=i,this},i.prototype.length=function(){var i=Math.sqrt(this.x*this.x+this.y*this.y);return i<.005&&i>-.005?1e-6:i},i.prototype.distance=function(i){var t=this.x-i.x,e=this.y-i.y;return Math.sqrt(t*t+e*e)},i.prototype.distanceSquared=function(i){var t=this.x-i.x,e=this.y-i.y;return t*t+e*e};var t=function(t){var e=t.id,s=t.radius,r=t.x,n=t.y,o=t.isPulledToCenter,a=t.isPinned;r=r||0,n=n||0,this.id=e,this.targetPosition=new i(0,0),this.position=new i(r,n),this.previousPosition=new i(r,n),this.isPulledToCenter=o,this.isPinned=a,this.setRadius(s)},e={delta:{configurable:!0}};t.prototype.setPosition=function(i){this.previousPosition=this.position,this.position=i.cp()},t.prototype.setRadius=function(i){this.radius=i,this.radiusSquared=i*i},e.delta.get=function(){return new i(this.position.x-this.previousPosition.x,this.position.y-this.previousPosition.y)},Object.defineProperties(t.prototype,e);var s=function(){this.allCircles=[],this.pinnedCircleIds=[],this.desiredTarget=new i(0,0),this.bounds={left:0,top:0,right:0,bottom:0},this.damping=.025,this.numberOfCenteringPasses=1,this.numberOfCollisionPasses=3,this.isCenterPullActive=!0};s.prototype.setBounds=function(i){\"number\"==typeof i.left&&(this.bounds.left=i.left),\"number\"==typeof i.right&&(this.bounds.right=i.right),\"number\"==typeof i.top&&(this.bounds.top=i.top),\"number\"==typeof i.bottom&&(this.bounds.bottom=i.bottom),\"number\"==typeof i.width&&(this.bounds.right=this.bounds.left+i.width),\"number\"==typeof i.height&&(this.bounds.bottom=this.bounds.top+i.height)},s.prototype.addCircle=function(i){i instanceof t||(i=new t({id:i.id,radius:i.radius,x:i.position.x||0,y:i.position.y||0,isPinned:i.isPinned||!1,isPulledToCenter:\"boolean\"!=typeof i.isPulledToCenter||i.isPulledToCenter})),this.allCircles.push(i),i.targetPosition=this.desiredTarget.cp()},s.prototype.removeCircle=function(i){this.allCircles.filter((function(t){return t.id===i})),this.allCircles=this.allCircles.filter((function(t){return t.id!==i}))},s.prototype.updatePositions=function(){for(var i=this.allCircles,t=i.length,e=0;e<t;++e){var s=i[e];s.previousPosition=s.position.cp()}this.desiredTarget&&this.isCenterPullActive&&this.pushAllCirclesTowardTarget(this.desiredTarget),this.handleCollisions();for(var r=0;r<t;++r){var n=i[r];this.handleBoundaryForCircle(n)}},s.prototype.pushAllCirclesTowardTarget=function(t){for(var e=new i(0,0),s=this.draggedCircle,r=this.allCircles,n=r.length,o=0;o<this.numberOfCenteringPasses;o++)for(var a=0;a<n;a++){var d=r[a];if(d.isPulledToCenter){if(d===s||this.isCirclePinned(d.id))continue;e.x=d.position.x-t.x,e.y=d.position.y-t.y,e.mul(this.damping),d.position.x-=e.x,d.position.y-=e.y}}},s.prototype.handleCollisions=function(){for(var t=new i(0,0),e=this.draggedCircle,s=this.allCircles,r=s.length,n=0;n<this.numberOfCollisionPasses;n++)for(var o=0;o<r;o++)for(var a=s[o],d=o+1;d<r;d++){var l=s[d],u=this.isCirclePinned(a.id),c=this.isCirclePinned(l.id),p=a===e||u,h=l===e||c;if(!(a===l||p&&h)){var f=l.position.x-a.position.x,y=l.position.y-a.position.y,C=1.08*(a.radius+l.radius),g=a.position.distanceSquared(l.position);if(g<C*C-.02){t.x=f,t.y=y,t.normalize();var b=.5*(C-Math.sqrt(g));t.mul(b),h||(p&&t.mul(2.2),l.position.x+=t.x,l.position.y+=t.y),p||(h&&t.mul(2.2),a.position.x-=t.x,a.position.y-=t.y)}}}},s.prototype.handleBoundaryForCircle=function(i){var t=i.position.x,e=i.position.y,s=i.radius,r=!1;t+s>=this.bounds.right?(i.position.x=this.bounds.right-s,r=!0):t-s<this.bounds.left&&(i.position.x=this.bounds.left+s,r=!0),e+s>this.bounds.bottom?(i.position.y=this.bounds.bottom-s,r=!0):e-s<this.bounds.top&&(i.position.y=this.bounds.top+s,r=!0),r&&i===this.draggedCircle&&(this.draggedCircle=null)},s.prototype.setDraggedCircle=function(i){this.draggedCircle=i},s.prototype.dragStart=function(i){var t=this.allCircles.filter((function(t){return t.id===i}))[0];this.setDraggedCircle(t)},s.prototype.dragEnd=function(){this.draggedCircle&&(this.draggedCircle=null)},s.prototype.drag=function(i,t){this.draggedCircle&&t&&(this.draggedCircle.position.x=t.x,this.draggedCircle.position.y=t.y)},s.prototype.isCirclePinned=function(i){var t=this.circleById(i);return!!t&&t.isPinned},s.prototype.pinCircle=function(i){var t=this.circleById(i);t&&(t.isPinned=!0)},s.prototype.unpinCircle=function(i){var t=this.circleById(i);t&&(t.isPinned=!1)},s.prototype.setCircleRadius=function(i,t){var e=this.circleById(i);e&&e.setRadius(t)},s.prototype.setCircleCenterPull=function(i,t){var e=this.circleById(i);e&&(e.isPulledToCenter=t)},s.prototype.setCenterPull=function(i){this.isCenterPullActive=i},s.prototype.circleById=function(i){return this.allCircles.filter((function(t){return t.id===i}))[0]},s.prototype.setTarget=function(i){this.desiredTarget=i},self.addEventListener(\"message\",(function(t){var e=function(i){return i.data?JSON.parse(i.data):void 0}(t);if(e){var s=e.action;switch(s.type){case\"SET_BOUNDS\":r.setBounds(s.bounds);break;case\"SET_CENTERING_PASSES\":r.numberOfCenteringPasses=s.numberOfCenteringPasses;break;case\"SET_COLLISION_PASSES\":r.numberOfCollisionPasses=s.numberOfCollisionPasses;break;case\"SET_DAMPING\":r.damping=s.damping;break;case\"SET_CENTER_PULL\":r.setCenterPull(s.centerPull);break;case\"UPDATE\":r.updatePositions(),a={type:\"MOVED\",updatedCircles:r.allCircles.reduce((function(i,t){return i[t.id]={id:t.id,position:t.position,previousPosition:t.previousPosition,radius:t.radius,delta:t.delta,isPulledToCenter:t.isPulledToCenter,isPinned:t.isPinned},i}),{})},function(i,t){i.postMessage(JSON.stringify(t))}(self,a);break;case\"ADD_CIRCLES\":o=s.circles,Array.isArray(o)&&o.length&&o.forEach(r.addCircle.bind(r));break;case\"REMOVE_CIRCLE\":r.removeCircle(s.id);break;case\"DRAG_START\":r.dragStart(s.id);break;case\"DRAG_END\":r.dragEnd(s.id);break;case\"DRAG_MOVE\":r.drag(s.id,s.position);break;case\"SET_CIRCLE_RADIUS\":r.setCircleRadius(s.id,s.radius);break;case\"SET_CIRCLE_CENTER_PULL\":r.setCircleCenterPull(s.id,s.centerPull);break;case\"PIN_CIRCLE\":r.pinCircle(s.id);break;case\"UNPIN_CIRCLE\":r.unpinCircle(s.id);break;case\"SET_TARGET\":(n=s.target)&&\"number\"==typeof n.x&&\"number\"==typeof n.y&&r.setTarget(new i(n))}}var n;var o;var a}));var r=new s}));\n"],{type:'text/javascript'}))),this.worker.addEventListener("message",this.receivedWorkerMessage.bind(this)),this.isContinuousModeActive="boolean"!=typeof t.continuousMode||t.continuousMode,this.onMoveStart=t.onMoveStart||null,this.onMove=t.onMove||null,this.onMoveEnd=t.onMoveEnd||null,this.lastCirclePositions=[],t.centeringPasses&&this.setCenteringPasses(t.centeringPasses),t.collisionPasses&&this.setCollisionPasses(t.collisionPasses),this.addCircles(t.circles||[]),this.setBounds(t.bounds||{width:100,height:100}),this.setTarget(t.target||{x:50,y:50}),this.isLooping=!1,this.areItemsMoving=!0,this.animationFrameId=NaN,this.initialized=!0,this.isContinuousModeActive&&this.startLoop()};return p.prototype.receivedWorkerMessage=function(t){var e=function(t){return t.data?JSON.parse(t.data):void 0}(t);if("MOVED"===e.type){var i=e.updatedCircles;this.areItemsMoving=this.hasItemMoved(i),!this.areItemsMoving&&this.isLooping&&this.initialized&&this.isContinuousModeActive&&this.stopLoop()}this.updateListeners(e)},p.prototype.updateWorker=function(t){var e,i;e=this.worker,i={messageId:Date.now()+o(0,.001,!0),action:t},e.postMessage(JSON.stringify(i))},p.prototype.updateListeners=function(t){"MOVE_START"===t.type&&"function"==typeof this.onMoveStart&&this.onMoveStart(),"MOVED"===t.type&&"function"==typeof this.onMove&&(this.lastCirclePositions=t.updatedCircles,this.onMove(t.updatedCircles)),"MOVE_END"===t.type&&"function"==typeof this.onMoveEnd&&this.onMoveEnd(t.updatedCircles)},p.prototype.addCircles=function(t){if(!Array.isArray(t))throw new Error("Can't add circles: the circles parameter is not an array.");if(t.length){if(!t.every(r))throw new Error("Can't add circles: some of the items are not well formatted.");this.updateWorker({type:"ADD_CIRCLES",circles:t}),this.startLoop()}},p.prototype.addCircle=function(t){this.addCircles([t])},p.prototype.removeCircle=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't remove circle: the circleRef parameter is malformed.");this.updateWorker({type:"REMOVE_CIRCLE",id:e}),this.startLoop()},p.prototype.pinCircle=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't pin circle: the circleRef parameter is malformed.");this.updateWorker({type:"PIN_CIRCLE",id:e}),this.startLoop()},p.prototype.unpinCircle=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't unpin circle: the circleRef parameter is malformed.");this.updateWorker({type:"UNPIN_CIRCLE",id:e}),this.startLoop()},p.prototype.setCircleRadius=function(t,e){var i="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(i))throw new Error("Can't set circle radius: the circleRef parameter is malformed.");if(!n(e,0))throw new Error("Can't set circle radius: the passed radius is malformed.");this.updateWorker({type:"SET_CIRCLE_RADIUS",id:i,radius:e}),this.startLoop()},p.prototype.setCircleCenterPull=function(t,e){var i="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(i))throw new Error("Can't set circle center pull: the circleRef parameter is malformed.");this.updateWorker({type:"SET_CIRCLE_CENTER_PULL",id:i,centerPull:!!e}),this.startLoop()},p.prototype.setCenterPull=function(t){this.updateWorker({type:"SET_CENTER_PULL",centerPull:!!t}),this.startLoop()},p.prototype.setBounds=function(t){if(!function(t){return"object"==typeof t&&"number"==typeof t.width&&"number"==typeof t.height}(t))throw new Error("Can't set bounds: the bounds parameter is malformed.");this.updateWorker({type:"SET_BOUNDS",bounds:t}),this.startLoop()},p.prototype.setTarget=function(t){if(!a(t))throw new Error("Can't set target: the targetPos parameter is malformed.");this.updateWorker({type:"SET_TARGET",target:t}),this.startLoop()},p.prototype.setCenteringPasses=function(t){if(!n(t,1))throw new Error("Can't set centering passes: the numberOfCenteringPasses parameter is malformed.");this.updateWorker({type:"SET_CENTERING_PASSES",numberOfCenteringPasses:t})},p.prototype.setCollisionPasses=function(t){if(!n(t,1))throw new Error("Can't set collisionPasses passes: the numberOfCollisionPasses parameter is malformed.");this.updateWorker({type:"SET_COLLISION_PASSES",numberOfCollisionPasses:t})},p.prototype.setDamping=function(t){if(!("number"==typeof t&&t>0&&t<1))throw new Error("Can't set damping: the damping parameter is malformed.");this.updateWorker({type:"SET_DAMPING",damping:t})},p.prototype.update=function(){this.updateWorker({type:"UPDATE"})},p.prototype.dragStart=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't start dragging circle: the circleRef parameter is malformed.");this.updateWorker({type:"DRAG_START",id:e}),this.startLoop()},p.prototype.drag=function(t,e){var i="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(i))throw new Error("Can't drag circle: the circleRef parameter is malformed.");if(!a(e))throw new Error("Can't drag circle: the position parameter is malformed.");this.updateWorker({type:"DRAG_MOVE",id:i,position:e}),this.startLoop()},p.prototype.dragEnd=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't end dragging circle: the circleRef parameter is malformed.");this.updateWorker({type:"DRAG_END",id:e}),this.startLoop()},p.prototype.updateLoop=function(){var t=this;this.update(),this.isLooping&&(this.areItemsMoving?this.animationFrameId=requestAnimationFrame((function(){return t.updateLoop()})):this.stopLoop())},p.prototype.startLoop=function(){var t=this;!this.isLooping&&this.initialized&&this.isContinuousModeActive&&(this.isLooping=!0,this.isContinuousModeActive&&(this.areItemsMoving=!0),this.updateListeners({type:"MOVE_START"}),this.animationFrameId=requestAnimationFrame((function(){return t.updateLoop()})))},p.prototype.stopLoop=function(){this.isLooping&&(this.isLooping=!1,this.updateListeners({type:"MOVE_END",updatedCircles:this.lastCirclePositions}),cancelAnimationFrame(this.animationFrameId))},p.prototype.hasItemMoved=function(t){var e=!1;for(var i in t)(Math.abs(t[i].delta.x)>.005||Math.abs(t[i].delta.y)>.005)&&(e=!0);return e},p.prototype.destroy=function(){this.worker&&this.worker.terminate(),this.stopLoop(),this.onMove=null,this.onMoveStart=null,this.onMoveEnd=null},p}));
