/*! circlepacker v1.1.7 | MIT (c) 2023 Georg Fischer <hi@snorpey.com> | https://github.com/snorpey/circlepacker#readme */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).CirclePacker=e()}(this,(function(){"use strict";var t=function(t,e){"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)};t.prototype.cp=function(){return new t(this.x,this.y)},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this},t.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,this},t.prototype.length=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return t<.005&&t>-.005?1e-6:t},t.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},t.prototype.distanceSquared=function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i};var e=function(e){var i=e.id,o=e.radius,r=e.x,s=e.y,n=e.isPulledToCenter,a=e.isPinned;r=r||0,s=s||0,this.id=i,this.targetPosition=new t(0,0),this.position=new t(r,s),this.previousPosition=new t(r,s),this.isPulledToCenter=n,this.isPinned=a,this.setRadius(o)},i={delta:{configurable:!0}};function o(t,e,i){"number"!=typeof t&&"number"!=typeof e&&(t=0,e=1),"number"!=typeof e&&(e=t,t=0);var o=t+Math.random()*(e-t);return i&&(o=parseInt(o,10)),o}function r(t){return t&&s(t.id)&&t.radius&&t.position&&"number"==typeof t.position.x&&"number"==typeof t.position.y}function s(t){return"number"==typeof t&&!isNaN(t)||"string"==typeof t&&t.length>0}function n(t,e){return"number"==typeof t&&t>=e}function a(t){return"object"==typeof t&&"number"==typeof t.x&&"number"==typeof t.y}e.prototype.setPosition=function(t){this.previousPosition=this.position,this.position=t.cp()},e.prototype.setRadius=function(t){this.radius=t,this.radiusSquared=t*t},i.delta.get=function(){return new t(this.position.x-this.previousPosition.x,this.position.y-this.previousPosition.y)},Object.defineProperties(e.prototype,i);var p=function(t){var e=t.workerPath?t.workerPath:"./CirclePackWorker.js";this.worker=new Worker(e,{type:"module"}),this.worker.addEventListener("message",this.receivedWorkerMessage.bind(this)),this.isContinuousModeActive="boolean"!=typeof t.continuousMode||t.continuousMode,this.onMoveStart=t.onMoveStart||null,this.onMove=t.onMove||null,this.onMoveEnd=t.onMoveEnd||null,this.lastCirclePositions=[],this.isLooping=!1,this.areItemsMoving=!1,this.animationFrameId=NaN,this.initialized=!0,t.centeringPasses&&this.setCenteringPasses(t.centeringPasses),t.collisionPasses&&this.setCollisionPasses(t.collisionPasses),this.addCircles(t.circles||[]),this.setBounds(t.bounds||{width:100,height:100}),this.setTarget(t.target||{x:50,y:50})};return p.prototype.receivedWorkerMessage=function(t){var e=function(t){return t.data?JSON.parse(t.data):void 0}(t);if("MOVED"===e.type){var i=e.updatedCircles;this.areItemsMoving=this.hasItemMoved(i),!this.areItemsMoving&&this.isLooping&&this.initialized&&this.isContinuousModeActive&&this.stopLoop()}this.updateListeners(e)},p.prototype.updateWorker=function(t){var e,i;e=this.worker,i={messageId:Date.now()+o(0,.001,!0),action:t},e.postMessage(JSON.stringify(i))},p.prototype.updateListeners=function(t){"MOVE_START"===t.type&&"function"==typeof this.onMoveStart&&this.onMoveStart(),"MOVED"===t.type&&"function"==typeof this.onMove&&(this.lastCirclePositions=t.updatedCircles,this.onMove(t.updatedCircles)),"MOVE_END"===t.type&&"function"==typeof this.onMoveEnd&&this.onMoveEnd(t.updatedCircles)},p.prototype.addCircles=function(t){if(!Array.isArray(t))throw new Error("Can't add circles: the circles parameter is not an array.");if(t.length){if(!t.every(r))throw new Error("Can't add circles: some of the items are not well formatted.");this.isContinuousModeActive&&(this.areItemsMoving=!0),this.updateWorker({type:"ADD_CIRCLES",circles:t}),this.startLoop()}},p.prototype.addCircle=function(t){this.addCircles([t])},p.prototype.removeCircle=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't remove circle: the circleRef parameter is malformed.");this.updateWorker({type:"REMOVE_CIRCLE",id:e}),this.startLoop()},p.prototype.pinCircle=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't pin circle: the circleRef parameter is malformed.");this.updateWorker({type:"PIN_CIRCLE",id:e}),this.startLoop()},p.prototype.unpinCircle=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't unpin circle: the circleRef parameter is malformed.");this.updateWorker({type:"UNPIN_CIRCLE",id:e}),this.startLoop()},p.prototype.setCircleRadius=function(t,e){var i="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(i))throw new Error("Can't set circle radius: the circleRef parameter is malformed.");if(!n(e,0))throw new Error("Can't set circle radius: the passed radius is malformed.");this.updateWorker({type:"SET_CIRCLE_RADIUS",id:i,radius:e}),this.startLoop()},p.prototype.setCircleCenterPull=function(t,e){var i="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(i))throw new Error("Can't set circle center pull: the circleRef parameter is malformed.");this.updateWorker({type:"SET_CIRCLE_CENTER_PULL",id:i,centerPull:!!e}),this.startLoop()},p.prototype.setCenterPull=function(t){this.updateWorker({type:"SET_CENTER_PULL",centerPull:!!t}),this.startLoop()},p.prototype.setBounds=function(t){if(!function(t){return"object"==typeof t&&"number"==typeof t.width&&"number"==typeof t.height}(t))throw new Error("Can't set bounds: the bounds parameter is malformed.");this.updateWorker({type:"SET_BOUNDS",bounds:t}),this.startLoop()},p.prototype.setTarget=function(t){if(!a(t))throw new Error("Can't set target: the targetPos parameter is malformed.");this.updateWorker({type:"SET_TARGET",target:t}),this.startLoop()},p.prototype.setCenteringPasses=function(t){if(!n(t,1))throw new Error("Can't set centering passes: the numberOfCenteringPasses parameter is malformed.");this.updateWorker({type:"SET_CENTERING_PASSES",numberOfCenteringPasses:t})},p.prototype.setCollisionPasses=function(t){if(!n(t,1))throw new Error("Can't set collisionPasses passes: the numberOfCollisionPasses parameter is malformed.");this.updateWorker({type:"SET_COLLISION_PASSES",numberOfCollisionPasses:t})},p.prototype.setDamping=function(t){if(!("number"==typeof t&&t>0&&t<1))throw new Error("Can't set damping: the damping parameter is malformed.");this.updateWorker({type:"SET_DAMPING",damping:t})},p.prototype.update=function(){this.updateWorker({type:"UPDATE"})},p.prototype.dragStart=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't start dragging circle: the circleRef parameter is malformed.");this.updateWorker({type:"DRAG_START",id:e}),this.startLoop()},p.prototype.drag=function(t,e){var i="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(i))throw new Error("Can't drag circle: the circleRef parameter is malformed.");if(!a(e))throw new Error("Can't drag circle: the position parameter is malformed.");this.updateWorker({type:"DRAG_MOVE",id:i,position:e}),this.startLoop()},p.prototype.dragEnd=function(t){var e="object"==typeof t&&void 0!==t.id?t.id:t;if(!s(e))throw new Error("Can't end dragging circle: the circleRef parameter is malformed.");this.updateWorker({type:"DRAG_END",id:e}),this.startLoop()},p.prototype.updateLoop=function(){var t=this;this.update(),this.isLooping&&(this.areItemsMoving?this.animationFrameId=requestAnimationFrame((function(){return t.updateLoop()})):this.stopLoop())},p.prototype.startLoop=function(){var t=this;!this.isLooping&&this.initialized&&this.isContinuousModeActive&&(this.isLooping=!0,this.updateListeners({type:"MOVE_START"}),this.animationFrameId=requestAnimationFrame((function(){return t.updateLoop()})))},p.prototype.stopLoop=function(){this.isLooping&&(this.isLooping=!1,this.updateListeners({type:"MOVE_END",updatedCircles:this.lastCirclePositions}),cancelAnimationFrame(this.animationFrameId))},p.prototype.hasItemMoved=function(t){var e=!1;for(var i in t)(Math.abs(t[i].delta.x)>.005||Math.abs(t[i].delta.y)>.005)&&(e=!0);return e},p.prototype.destroy=function(){this.worker&&this.worker.terminate(),this.stopLoop(),this.onMove=null,this.onMoveStart=null,this.onMoveEnd=null},p}));
